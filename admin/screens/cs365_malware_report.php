<?php
/*________________________________________________________________
________________________________________________________________*/
function report_1()
{
	$object_t[0] = 'html files';
	$object_t[1] = 'Google Black List';
	$object_t[2] = 'Javascript code';
	$object_t[3] = 'PHP code';
	$object_t[4] = 'Javascript filename';
	$object_t[5] = 'PHP filename';
	$object_t[6] = 'URL';
	$object_t[7] = 'Suspecious PHP';
	$object_t[8] = 'Suspecious Javascript';
	$object_t[9] = 'htaccess';
	$object_t[10] = 'Suspecious Theme';
	$object_t[11] = 'PHP code in image folder';
	$object_t[12] = 'Compressed files';

	$ext = '?page=cloudsafe365-malware&';

$request = "select last_scan_id from cs365_malware_results order by id desc limit 1";
$mysql = mysql_query($request) or print mysql_error();
$num_mysql = mysql_num_rows($mysql) or print mysql_error();

if ($num_mysql > 0)
{
list($last_scan_id) = mysql_fetch_row($mysql);
}

$request = "select def_id,count(id) as counter from cs365_malware_results where last_scan_id = $last_scan_id group by def_id";
$mysql = mysql_query($request) or print mysql_error();
$num_mysql = mysql_num_rows($mysql) or print mysql_error();
if ($num_mysql > 0)
{
$total_objects = 0;
while ($row = mysql_fetch_assoc($mysql))
	{
	$object_t_totals[$object_t[$row['def_id']]] = '<span style="color:red;font-weight:bold">'.$row['counter'].'</span>';
	$a_start[$row['def_id']] = '<a href="'.$ext .'report_page=2&def_id='.$row['def_id'].'&scan_id='.$last_scan_id.'">';
	$a_end[$row['def_id']] = '</a>';
	$total_objects += $row['counter'];
	}
}
$request = "select count(id) as counter from cs365_malware_system";
$mysql = mysql_query($request) or print mysql_error();
$num_mysql = mysql_num_rows($mysql) or print mysql_error();
$total_scanned = 0;
if ($num_mysql > 0)
{
list($total_scanned) = mysql_fetch_row($mysql);
$objperc_total = round(($total_objects/$total_scanned)*100,0).'%';
}

$request = "select wp_type,count(id) as counter from cs365_malware_system group by wp_type order by counter desc";
$mysql = mysql_query($request) or print mysql_error();
$num_mysql = mysql_num_rows($mysql) or print mysql_error();

if ($num_mysql > 0)
{
while ($row = mysql_fetch_assoc($mysql))
	{
	$types[$row['wp_type']] = $row['counter'];
	$typesp[$row['wp_type']] = round(($row['counter']/$total_scanned)*100,0).'%';
	}
}

for($i=0;$i<count($object_t);$i++)
    {

	    if (!isset($object_t_totals[$object_t[$i]]))
	    {
	   $object_t_totals[$object_t[$i]] = 0;
	   $a_start[$i] = '';
	   $a_end[$i] = '';
	    }
    }
$row_dat = 0;
?>

<table border="0" cellspacing="20">
  <tr>
    <td valign="top" class="stuffbox"><table border=" " cellpadding="2">
      <tr>
        <td colspan="2" align="middle" style="color:#21759B"><strong>Objects Detected</strong></td>
      </tr>
      <tr>
        <td width="155"><strong><?PHP echo $a_start[$row_dat];?><?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
      <tr>
        <td><strong>
          <?PHP $row_dat+=1; echo $a_start[$row_dat];?>
          <?PHP echo $object_t[$row_dat];?><?PHP echo $a_end[$row_dat];?></strong></td>
        <td align="right"><?PHP echo $object_t_totals[$object_t[$row_dat]];?></td>
      </tr>
    </table></td>
    <td align="top" class="stuffbox">
    <table width="100%" cellpadding="20">
	<tr>
		<td class="stuffbox">
<table  width="100%" border=" " cellpadding="0">
      <tr>
      <tr>
        <td colspan="2" align="middle" style="color:#21759B"><strong>Scanning Information</strong></td>
      </tr>
        <td width="158"><div><strong >Files scanned</strong></td>
        <td width="49"><?PHP echo $total_scanned;?></td>
        <td>&nbsp;</td>
      </tr>
      <tr>
        <td><div><strong >Objects Detected </strong></td>
        <td><?PHP echo $total_objects;?></td>
        <td><?PHP echo $objperc_total?></td>
      </tr>
      <tr>
        <td><div><strong >Suspicious Code</strong></td>
        <td>SC</td>
        <td>SC%</td>
      </tr>
      <tr>
      </table>
      </td>
	</tr>
	<tr>
	<td class="stuffbox">
<table width="100%"  border=" " cellpadding="0">
      <tr>
        <td colspan="3" align="middle" style="color:#21759B"><strong>Files that were scanned</strong></td>
      </tr>
      <?PHP

      foreach ($types as $type => $count)
      {
?>
      <tr>
        <td width="158"><?PHP echo $type;?></td>
        <td width="49"><?PHP echo $count;?></td>
        <td><?PHP echo $typesp[$type];?></td>
      </tr>
<?PHP
      }


      ?>
    </table>
	</td>
	</tr>
    </table>


</td>
  </tr>
</table>

<?PHP
      }
function report_2()
	{
$request = "
select *
from
cs365_malware_results
LEFT JOIN (cs365_malware_system)
ON (cs365_malware_results.file_id = cs365_malware_system.id)
Where
cs365_malware_results.def_id =  '".$_GET["def_id"]."'
AND
cs365_malware_results.last_scan_id ='".$_GET["scan_id"]."'
";

$mysql = mysql_query($request) or print mysql_error();
$num_mysql = mysql_num_rows($mysql) or print mysql_error();

if ($num_mysql > 0)
{

echo '<table cellspacing="2">';

while ($row = mysql_fetch_assoc($mysql))
	{
//	$array[] = $row;
	echo '<tr>

	<td>'.$row['filename'].'</td>
	<td>'.$row['directory'].'</td>

	</tr>';
	}
echo '</table>';
}

	}
      ?>
               <div class="wrap about-wrap" style="width:790px">
                    <div style="width:790px; float:left; clear:left; display:inline; margin: 0 20px 12px 0">
                         <div class="postbox metabox-holder">
                              <h3 style="font-family:Arial, Helvetica, sans-serif; font-weight:bold; font-size:16px; color:#21759B;" id="cs365_box_title">Malware Report</h3>
                              <div class="inside" style="font-size:13px; font-weight:inherit;">
                                   <fieldset>
				<?PHP
					if (!isset($_GET["report_page"])) $_GET["report_page"] = 1;
					call_user_func( 'report_'.$_GET["report_page"])
				 ?>
                                   </fieldset>
                              </div>

                         </div>
                    </div>
               </div>